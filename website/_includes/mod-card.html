{%- assign st = mod.status | to_s | strip | downcase -%}
{%- unless st == "hidden" -%}
{%- assign slug = mod.slug | default: page.slug | default: page.mod_slug -%}
{%- assign auto = site.data.auto_mods[slug] -%}

<!-- 進捗情報の取得 -->
{%- assign p = site.data.auto_progress.mods[slug] -%}
{%- if p == nil and site.data.auto_mods and site.data.auto_mods.mods[slug] and site.data.auto_mods.mods[slug].progress -%}
{%- assign p = site.data.auto_mods.mods[slug].progress -%}
{%- elsif p == nil and auto and auto.progress -%}
{%- assign p = auto.progress -%}
{%- endif -%}

<!-- ここからカード本体 -->
{%- assign heading_id = 'mod-' | append: mod.slug -%}
<article class="mod-group" aria-labelledby="{{ heading_id }}">
  <div class="mod-card{% if st == 'retired' %} is-outdated{% endif %}{% if st == 'upcoming' %} is-upcoming{% endif %}">
    <h4 id="{{ heading_id }}">
      {% if st == 'upcoming' %}準備中: {% endif %}
      {{ mod.title }}
    </h4>

    {% if has_detail and detail_page and detail_page.url %}
    <p class="detail-link-area">
      <a href="{{ detail_page.url | relative_url }}" class="detail-link">個別紹介ページを見る ↗️</a>
    </p>
    {% endif %}

    {% if p and p.pct %}
    {% assign pct = p.pct | plus: 0 %}
    <span class="mod-progress--inline">
      <strong>翻訳進捗:</strong>
      <span class="num">
        {{ p.pct | round: 1 }}%（{{ p.done }}/{{ p.total }}）
        {% if pct >= 100 %}
        <span class="done">完成！🎉</span>
        {% elsif pct >= 99 %}
        <span class="almost-done">実質完成✨</span>
        {% elsif pct >= 70 %}
        <span class="good">たぶん順調😎</span>
        {% elsif pct >= 40 %}
        <span class="meh">折り返し地点💡</span>
        {% elsif pct >= 15 %}
        <span class="low">まだ道半ばです🔥</span>
        {% else %}
        <span class="very-low">…🥺</span>
        {% endif %}
      </span>
      
      <span class="bar" role="progressbar" aria-valuenow="{{ p.pct | round: 1 }}" aria-valuemin="0" aria-valuemax="100" aria-label="翻訳進捗 {{ p.pct | round: 1 }}パーセント" style="--p: {{ p.pct | at_most: 100 | at_least: 0 }}%">
        <i class="fill"></i>
      </span>
      </span>
      {% endif %}

    <div class="mod-info">
<ul class="mod-info-list">
  <li>
    <strong>対応MOD Ver:</strong>
    {%- if mod.mod_ver and mod.mod_ver | to_s | strip != "" -%}
    {{ mod.mod_ver }}
    {%- else -%}
    ―
    {%- endif -%}
  </li>

  {%- assign slug = mod.slug -%}
  {%- assign auto = site.data.auto_mods[slug] -%}

  {%- if auto and auto.updated -%}
  <li><strong>最終更新日:</strong> {{ auto.updated }}</li>
  {%- endif -%}

  {%- if auto and auto.size_kb -%}
  <li><strong>ファイルサイズ:</strong> {{ auto.size_kb | round: 1 }}KB</li>
  {%- endif -%}

  {%- if mod.requires and mod.requires != empty -%}
  <li class="requires">
    <strong>前提MOD:</strong> {% include requirements.html items=mod.requires %}
  </li>
  {%- endif -%}
</ul>

    </div>

    {%- unless st == "retired" or st == "upcoming" -%}
    {%- assign dl_href = mod.download.url
    | default: '/translations/'
    | append: mod.slug
    | append: '/i18n/ja.json'
    | relative_url -%}
    <a href="{{ dl_href }}" class="download-btn" target="_blank" rel="noopener" role="button" download>
      <span aria-hidden="true">📥</span> ファイルをダウンロード
      {% if mod.mod_ver and mod.mod_ver | strip != "" %}
      （v{{ mod.mod_ver }}）
      {% endif %}
    </a>
    {%- endunless -%}

    {% if mod.summary %}
    <p class="note">{{ mod.summary | newline_to_br | replace: '<br />', '<br>' }}</p>
    {% endif %}

    {% if mod.note %}
    <p class="mod-supplement">{{ mod.note }}</p>
    {% endif %}
  </div>

  <div class="original-mod-link-inline">
    <div class="card-content-inline">
      <h4>{{ mod.original_name }}</h4>
      <p class="card-source-inline">
        配布元:
        {% if mod.source and mod.source != empty %}
        {% for s in mod.source %}
        {{ s.name | default: "Nexus Mods" }}{% unless forloop.last %}、{% endunless %}
        {% endfor %}
        {% else %}
        Nexus Mods
        {% endif %}
      </p>
    </div>

    {% if mod.links and mod.links.url %}
    <a href="{{ mod.links.url }}" target="_blank" rel="noopener" class="mod-link-btn">
      {{ mod.links.label | default: "MOD本体サイトへ移動" }}
    </a>
    {% endif %}
  </div>
</article>
{%- endunless -%}